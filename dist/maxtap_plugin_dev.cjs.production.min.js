"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){for(var e=document.querySelectorAll("[data-displaymaxtap]"),n=0;n<e.length;n++)if("VIDEO"===e[n].tagName)return e[n];console.error('Cannot find video element,Please check data attribute. It should be data-displaymaxtap\n                   Example: <video src="https://some_source" data-displaymaxtap > </video> \n                            [OR]\n                   Try to initialize the maxtap_ad component after window load.')};exports.Component=function(){function n(n){var t=this;this.current_component_index=0,this.init=function(){var n;if(t.video=e(),t.video)try{(n=t.content_id,new Promise((function(e,t){try{n.includes(".json")||(n+=".json"),fetch("https://storage.googleapis.com/maxtap-adserver-dev.appspot.com/"+n,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(n){n.json().then((function(n){n.sort((function(e,n){return parseInt(e.start_time)<parseInt(n.start_time)?-1:parseInt(e.start_time)>parseInt(n.start_time)?1:0})),e(n)}))})).catch((function(e){t(e)}))}catch(e){t(e)}}))).then((function(e){t.components_data=e,t.components_data&&(t.initializeComponent(),document.getElementById("componentmaxtap").addEventListener("click",(function(){t.onComponentClick()})),setInterval((function(){t.updateComponent()}),500))})).catch((function(e){console.error(e)}))}catch(e){console.error(e)}else console.error('Cannot find video element,Please check data attribute. It should be data-displaymaxtap\n            Example: <video src="https://some_source" data-displaymaxtap > </video> \n            [OR]\n            Try to initialize the maxtap_ad component after window load.\n            ')},this.updateComponent=function(){if(t.video&&t.components_data){var e=function(e,n){for(var t=0;t<e.length;t++){var o=e[t];if(n>=o.start_time&&n<=o.end_time)return t}return-1}(t.components_data,t.video.currentTime);e>=0?t.current_component_index=e:t.removeCurrentComponent(),!t.components_data[t.current_component_index].is_image_loaded&&t.components_data[t.current_component_index].start_time-t.video.currentTime<=15&&t.prefetchImage(),t.canComponentDisplay(t.video.currentTime)&&t.displayComponent(),t.canCloseComponent(t.video.currentTime)&&(t.current_component_index++,t.removeCurrentComponent())}else console.error("Cannot find video element with id ")},this.initializeComponent=function(){var n;if(t.video&&(t.video.style.width="100%",t.video.style.height="100%",t.parentElement=t.video.parentElement,t.parentElement)){t.parentElement.style.position="relative";var o=document.createElement("div");o.style.display="none",o.id="componentmaxtap",o.className="maxtap_component_wrapper",null==(n=t.parentElement)||n.appendChild(o);for(var a=0;a<t.components_data.length;a++)t.components_data[a].is_image_loaded=!1;t.video=e()}},this.prefetchImage=function(){t.components_data&&(t.components_data[t.current_component_index].is_image_loaded=!0,(new Image).src=t.components_data[t.current_component_index].image_link)},this.canComponentDisplay=function(e){return!!t.components_data&&!(t.components_data[t.current_component_index].start_time<0)&&e>=t.components_data[t.current_component_index].start_time},this.canCloseComponent=function(e){return!t.components_data||!(t.components_data[t.current_component_index].start_time<0)&&e>=t.components_data[t.current_component_index].end_time},this.displayComponent=function(){var e=document.getElementById("componentmaxtap");if(e){var n='\n        <div class="maxtap_main" >\n        <p>'+t.components_data[t.current_component_index].caption_regional_language+'</p>\n        <div class="maxtap_img_wrapper">\n        <img src="'+t.components_data[t.current_component_index].image_link+'"/>\n        </div>\n        </div>\n        ';"none"===e.style.display&&(e.style.display="flex",e.innerHTML=n),window.gtag("event","watch",{event_category:"impression",event_action:"watch",content_id:t.content_id})}},this.onComponentClick=function(){window.gtag("event","click",{event_category:"action",event_action:"click",content_id:t.content_id,click_time:Math.floor(t.video.currentTime)}),t.components_data&&window.open(t.components_data[t.current_component_index].redirect_link,"_blank")},this.content_id=n.content_id,this.parentElement=null;var o=document.createElement("link");o.href="https://unpkg.com/maxtap_plugin_dev@0.1.27/dist/styles.css",o.rel="stylesheet";var a=document.createElement("script");a.src="https://www.googletagmanager.com/gtag/js?id=G-05P2385Q2K",a.async=!0,a.id="G-05P2385Q2K",a.addEventListener("load",(function(){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config","G-05P2385Q2K")}));var i=document.querySelector("head");null==i||i.appendChild(o),null==i||i.appendChild(a),console.log("update-2")}return n.prototype.removeCurrentComponent=function(){var e=document.getElementById("componentmaxtap");e&&"none"!==e.style.display&&(e.style.display="none",e.innerHTML="")},n}();
//# sourceMappingURL=maxtap_plugin_dev.cjs.production.min.js.map
