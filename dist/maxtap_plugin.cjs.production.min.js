"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("uuid");exports.Component=function(){function t(t){var n=this;this.component_start_time=-1,this.component_end_time=-1,this.current_component_index=0,this.is_component_showing=!1,this.init=function(){var t;if(n.video=document.querySelector("[data-displaymaxtap]"),n.video)try{(t=n.content_id,new Promise((function(n,o){try{t.includes(".json")||(t+=".json"),fetch("https://storage.googleapis.com/maxtap-adserver-dev.appspot.com/"+t+"?rd_id="+e.v4(),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){e.json().then((function(e){e.sort((function(e,t){return parseInt(e.start_time)<parseInt(t.start_time)?-1:parseInt(e.start_time)>parseInt(t.start_time)?1:0})),n(e)}))})).catch((function(e){o(e)}))}catch(e){o(e)}}))).then((function(e){if(n.component_data=e,n.component_data){n.setRequiredComponentData(),n.initializeComponent();var t=document.getElementById("componentmaxtap");null==t||t.addEventListener("click",(function(){})),n.interval_id=setInterval((function(){n.video?(!n.is_image_loaded&&n.component_start_time-n.video.currentTime<=15&&n.prefetchImage(),n.canComponentDisplay(n.video.currentTime)?n.displayComponent():n.canCloseComponent(n.video.currentTime)&&(n.current_component_index++,n.removeCurrentComponent())):console.error("Cannot find video element with id ")}),500)}})).catch((function(e){console.error(e)}))}catch(e){console.error(e)}else console.error('Cannot find video element,Please check data attribute. It should be data-displaymaxtap\n            Example:\n            <video src="https://some_source" data-displaymaxtap > </video> ')},this.initializeComponent=function(){var e;if(n.video){n.video.style.width="100%",n.video.style.height="100%",n.parentElement=n.video.parentElement;var t=document.createElement("div"),o=document.createElement("div");o.className="maxtap_container",o.id="containermaxtap",t.style.display="none",t.addEventListener("click",n.onComponentClick),t.id="componentmaxtap",t.className="maxtap_component_wrapper",o.appendChild(n.video),o.appendChild(t),null==(e=n.parentElement)||e.appendChild(o),n.video=document.querySelector("[data-displaymaxtap]")}},this.prefetchImage=function(){n.component_data&&(n.is_image_loaded=!0,(new Image).src=n.component_data[n.current_component_index].image_url)},this.canComponentDisplay=function(e){return!(n.component_start_time<0)&&e>=n.component_start_time&&!n.is_component_showing},this.canCloseComponent=function(e){return!(n.component_start_time<0||!(e>=n.component_end_time&&n.is_component_showing))},this.displayComponent=function(){var e=document.getElementById("componentmaxtap");e&&(e.style.display="flex",e.innerHTML='\n        <div class="maxtap_main" >\n            <p>'+n.product_details+'</p>\n            <div class="maxtap_img_wrapper">\n                <img src="'+n.image_url+'"/>\n            </div>\n        </div>\n        ',window.gtag("event","watch",{event_category:"impression",event_action:"watch",content_id:n.content_id}),n.is_component_showing=!0)},this.onComponentClick=function(){window.gtag("event","click",{event_category:"action",event_action:"click",content_id:n.content_id,click_time:Math.floor(n.video.currentTime)}),n.redirect_url&&window.open(n.redirect_url,"_blank")},this.content_id=t.content_id,this.parentElement=null,this.is_image_loaded=!1;var o=document.createElement("link");o.href="https://unpkg.com/maxtap_plugin@0.1.12/dist/styles.css",o.rel="stylesheet";var i=document.createElement("script");i.src="https://www.googletagmanager.com/gtag/js?id=G-05P2385Q2K",i.async=!0,i.id="G-05P2385Q2K",i.addEventListener("load",(function(){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config","G-05P2385Q2K")}));var a=document.querySelector("head");null==a||a.appendChild(o),null==a||a.appendChild(i)}var n=t.prototype;return n.removeCurrentComponent=function(){var e=document.getElementById("componentmaxtap");this.current_component_index>=this.component_data.length?clearInterval(this.interval_id):this.setRequiredComponentData(),e&&(e.style.display="none",e.innerHTML="",this.is_image_loaded=!1,this.is_component_showing=!1)},n.setRequiredComponentData=function(){if(this.component_data){var e=this.component_data;this.component_start_time=parseInt(e[this.current_component_index].start_time),this.image_url=e[this.current_component_index].image_link,this.redirect_url=e[this.current_component_index].redirect_link,this.product_details=e[this.current_component_index].caption_regional_language,this.component_end_time=parseInt(e[this.current_component_index].end_time)}},t}();
//# sourceMappingURL=maxtap_plugin.cjs.production.min.js.map
