"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Component=function(){function t(t){var e=this;this.component_start_time=-1,this.component_end_time=-1,this.current_component_index=0,this.is_component_showing=!1,this.init=function(){var t;if(e.video=document.querySelector("[data-displaymaxtap]"),e.video)try{(t=e.content_id,new Promise((function(e,n){try{t.includes(".json")||(t+=".json"),fetch("https://storage.googleapis.com/maxtap-adserver-dev.appspot.com/"+t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(t){t.json().then((function(t){t.sort((function(t,e){return parseInt(t.start_time)<parseInt(e.start_time)?-1:parseInt(t.start_time)>parseInt(e.start_time)?1:0})),e(t)}))})).catch((function(t){n(t)}))}catch(t){n(t)}}))).then((function(t){if(e.component_data=t,e.component_data){e.setRequiredComponentData(),e.initializeComponent();var n=document.getElementById("componentmaxtap");null==n||n.addEventListener("click",(function(){})),e.interval_id=setInterval((function(){e.video?(!e.is_image_loaded&&e.component_start_time-e.video.currentTime<=15&&e.prefetchImage(),e.canComponentDisplay(e.video.currentTime)?e.displayComponent():e.canCloseComponent(e.video.currentTime)&&(e.current_component_index++,e.removeCurrentComponent())):console.error("Cannot find video element with id ")}),500)}})).catch((function(t){console.error(t)}))}catch(t){console.error(t)}else console.error('Cannot find video element,Please check data attribute. It should be data-displaymaxtap\n            Example:\n            <video src="https://some_source" data-displaymaxtap > </video> ')},this.initializeComponent=function(){var t;if(e.video){e.video.style.width="100%",e.video.style.height="100%",e.parentElement=e.video.parentElement;var n=document.createElement("div"),o=document.createElement("div");o.className="maxtap_container",o.id="containermaxtap",n.style.display="none",n.addEventListener("click",e.onComponentClick),n.id="componentmaxtap",n.className="maxtap_component_wrapper",o.appendChild(e.video),o.appendChild(n),null==(t=e.parentElement)||t.appendChild(o),e.video=document.querySelector("[data-displaymaxtap]")}},this.prefetchImage=function(){e.component_data&&(e.is_image_loaded=!0,(new Image).src=e.component_data[e.current_component_index].image_url)},this.canComponentDisplay=function(t){return!(e.component_start_time<0)&&t>=e.component_start_time&&!e.is_component_showing},this.canCloseComponent=function(t){return!(e.component_start_time<0||!(t>=e.component_end_time&&e.is_component_showing))},this.displayComponent=function(){var t=document.getElementById("componentmaxtap");t&&(t.style.display="flex",t.innerHTML='\n        <div class="maxtap_main" >\n            <p>'+e.product_details+'</p>\n            <div class="maxtap_img_wrapper">\n                <img src="'+e.image_url+'"/>\n            </div>\n        </div>\n        ',window.gtag("event","watch",{event_category:"impression",event_action:"watch",content_id:e.content_id}),e.is_component_showing=!0)},this.onComponentClick=function(){window.gtag("event","click",{event_category:"action",event_action:"click",content_id:e.content_id,click_time:Math.floor(e.video.currentTime)}),e.redirect_url&&window.open(e.redirect_url,"_blank")},this.content_id=t.content_id,this.parentElement=null,this.is_image_loaded=!1;var n=document.createElement("link");n.href="https://unpkg.com/maxtap_plugin@0.1.14/dist/styles.css",n.rel="stylesheet";var o=document.createElement("script");o.src="https://www.googletagmanager.com/gtag/js?id=G-05P2385Q2K",o.async=!0,o.id="G-05P2385Q2K",o.addEventListener("load",(function(){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config","G-05P2385Q2K")}));var i=document.querySelector("head");null==i||i.appendChild(n),null==i||i.appendChild(o)}var e=t.prototype;return e.removeCurrentComponent=function(){var t=document.getElementById("componentmaxtap");this.current_component_index>=this.component_data.length?clearInterval(this.interval_id):this.setRequiredComponentData(),t&&(t.style.display="none",t.innerHTML="",this.is_image_loaded=!1,this.is_component_showing=!1)},e.setRequiredComponentData=function(){if(this.component_data){var t=this.component_data;this.component_start_time=parseInt(t[this.current_component_index].start_time),this.image_url=t[this.current_component_index].image_link,this.redirect_url=t[this.current_component_index].redirect_link,this.product_details=t[this.current_component_index].caption_regional_language,this.component_end_time=parseInt(t[this.current_component_index].end_time)}},t}();
//# sourceMappingURL=maxtap_plugin.cjs.production.min.js.map
