{"version":3,"file":"maxtap_ads.cjs.production.min.js","sources":["../src/app.ts","../src/Utils/utils.ts","../src/config.ts"],"sourcesContent":["import { DataAttribute, GoogleAnalyticsCode, MaxTapComponentElementId, MaxTapMainContainerId } from './config.js';\nimport { queryData } from './Utils/utils.js';\n/* \n*   A Brief about how MAXTAP Ad  ðŸ”ŒpluginðŸ”Œ works\n?ðŸ›‘ ** Note **: Here in variables,function names..etc component refers to ad, we need to make it because of ad-blockers.\n*  \n*                       ------- * Steps * ---------\n*     => Find video element by data attribute set to the video element ðŸ“¹.\n*\n*     => Once we make sure that video element is available,\n*       Create a main container ðŸ“¦ <div class=\"maxtap_container\"></div> element and add the video element into the created container.\n*\n*     => Set the css properties of main container as same as video parent element.\n*\n*     => Now ðŸ’‰inject maxtap adðŸ“„ component into the main container and next to video element.\n*     \n*     => Then set position,width,font ..etc of ad component to make it look good.\n*\n*     => Then finally add this main element which we created before to video parent element.\n\n*            ðŸ“¦ Our Main container ðŸ“¦\n*                    |\n*          __________|_____________\n*         |                       |\n*   [client video elementðŸ“¹]       [Our Ad element ðŸ“„]\n*\n*\n */\n\ndeclare global {\n    interface Window { Maxtap: any; gtag: any; dataLayer: any[] }\n}\n\nexport class Component {\n\n    private video?: HTMLVideoElement;\n    private parentElement: HTMLElement | null;\n    private component_start_time = -1;\n    private component_end_time = -1;\n    private product_details?: string;\n    private image_url?: string;\n    private redirect_url?: string;\n    private current_component_index = 0;\n    private component_data?: [];\n    private interval_id: any;\n    private is_component_showing = false;\n    private content_id: string;\n    private image_loaded: boolean;\n\n    constructor(content_id: string) {\n        this.content_id = content_id;\n        this.parentElement = null;\n        this.image_loaded = false;\n        const css_file = document.createElement('link');\n        css_file.href = \"https://unpkg.com/maxtap_ads_js@latest/dist/maxtap_styles.css\";\n        css_file.rel = 'stylesheet';\n\n        const ga_script = document.createElement('script');\n        ga_script.src = `https://www.googletagmanager.com/gtag/js?id=${GoogleAnalyticsCode}`;\n        ga_script.async = true;\n        ga_script.id = GoogleAnalyticsCode;\n        ga_script.addEventListener('load', () => {\n\n            window.dataLayer = window.dataLayer || [];\n            window.gtag = function () { window.dataLayer.push(arguments); }\n            window.gtag('js', new Date());\n            window.gtag('config', GoogleAnalyticsCode)\n\n        })\n        const head_tag = document.querySelector('head');\n        head_tag?.appendChild(css_file);\n        head_tag?.appendChild(ga_script);\n    }\n\n    init = () => {\n\n        this.video = document.querySelector(`[${DataAttribute}]`) as HTMLVideoElement;\n        if (!this.video) {\n            console.error(\"Cannot find video element,Please check data attribute. It should be \" + DataAttribute + `\n            Example:\n            <video src=\"some_source\" ${DataAttribute} > </video>\n            `);\n            return;\n        }\n        queryData(this.content_id).then(data => {\n            this.component_data = data\n\n            if (!this.component_data) { return; }\n            this.setRequiredComponentData();\n\n            this.initializeComponent();\n            const maxtap_component = document.getElementById(MaxTapComponentElementId);\n\n            maxtap_component?.addEventListener('click', () => {\n            })\n\n            //* Checking for every second if video time is equal to ad start time.\n\n            this.interval_id = setInterval(() => {\n\n                if (!this.video) {\n                    console.error(\"Cannot find video element with id \");\n                    return;\n                }\n\n                if (!this.image_loaded && ((this.component_start_time - this.video!.currentTime) <= 15)) {\n                    console.log(\"Loding\");\n                    this.prefetchImage();\n                }\n\n                if (this.canComponentDisplay(this.video!.currentTime)) {\n                    this.displayComponent();\n                    return;\n                }\n                if (this.canCloseComponent(this.video!.currentTime)) {\n                    this.current_component_index++;\n                    this.removeCurrentComponent();\n\n                }\n\n\n                //* Updating the current ad data to next ad data.;\n\n            }, 500);\n        })\n    }\n\n\n\n    private initializeComponent = () => {\n        //*  Getting data from firestore using http request. And changing state of component.\n\n        if (!this.video) { return; }\n        this.video.style.width = \"100%\";\n        this.video.style.height = \"100%\";\n\n\n        this.parentElement = this.video.parentElement;\n\n        const ad_ele = document.createElement('div');\n        const main_container = document.createElement('div') as HTMLDivElement;\n\n        main_container.className = 'maxtap_container';\n        main_container.id = MaxTapMainContainerId;\n\n        ad_ele.style.display = 'none';\n        ad_ele.addEventListener('click', this.onComponentClick);\n        ad_ele.id = MaxTapComponentElementId;\n        ad_ele.className = 'maxtap_component_wrapper';\n\n        main_container.appendChild(this.video);\n        main_container.appendChild(ad_ele);\n\n        this.parentElement?.appendChild(main_container);\n\n        //!<------------------>  Re-initializing the video to get latest reference after manipulating dom elements.<----------------------->\n\n        this.video = document.querySelector(`[${DataAttribute}]`) as HTMLVideoElement;\n    }\n\n    private prefetchImage = () => {\n        if (!this.component_data) { return; }\n        this.image_loaded = true;\n        let img = new Image();\n        img.src = this.component_data[this.current_component_index]['img_url'];\n    }\n\n\n    private canComponentDisplay = (currentTime: number): boolean => {\n        if (this.component_start_time < 0) { return false; }\n        //* Checking video time and also if video is already shown.\n        if ((currentTime >= this.component_start_time) && !this.is_component_showing) {\n            return true;\n        };\n        return false;\n    }\n\n    private canCloseComponent = (currentTime: number): boolean => {\n\n        if (this.component_start_time < 0) { return false; }\n        if ((currentTime >= this.component_end_time) && this.is_component_showing) {\n            return true;\n        }\n        return false;\n    }\n\n    private removeCurrentComponent() {\n        const ad_ele = document.getElementById(MaxTapComponentElementId);\n        if (this.current_component_index >= this.component_data!.length) {\n            console.log(\"clear interval\");\n            clearInterval(this.interval_id);\n        }\n        else {\n            this.setRequiredComponentData(); // * Updating next ad data to class variables.\n        }\n        if (!ad_ele) { return; }\n        ad_ele.style.display = \"none\";\n        ad_ele.innerHTML = '';\n        this.image_loaded = false;\n        this.is_component_showing = false;\n    }\n\n    private displayComponent = () => {\n\n        //* Displaying ad by just changing css display:none -> display:flex\n\n        const ad_ele = document.getElementById(MaxTapComponentElementId);\n        if (!ad_ele) { return; }\n        ad_ele.style.display = 'flex';\n        // ReactGa.set({ 'contend_id': this.props.content_id });\n        // ReactGa.event({ action: \"AD_VIEW\", category: \"AD\" });\n        ad_ele.innerHTML = `\n        <div class=\"maxtap_main\" >\n            <p>${this.product_details}</p>\n            <div class=\"maxtap_img_wrapper\">\n                <img src=\"${this.image_url}\"/>\n            </div>\n        </div>\n        `\n        window.gtag('event', 'ad_watch', {\n            'event_category': 'impression',\n            'event_action': 'watch',\n            \"content_id\": this.content_id,\n        })\n        this.is_component_showing = true;\n\n    }\n\n    private onComponentClick = () => {\n\n        window.gtag('event', 'ad_click', {\n            'event_category': 'action',\n            'event_action': 'click',\n            \"content_id\": this.content_id,\n            \"click_time\": Math.floor(this.video!.currentTime)\n        })\n\n        if (!this.redirect_url) { return; }\n        window.open(this.redirect_url, \"_blank\");\n    }\n\n\n    private setRequiredComponentData() {\n\n        //* Setting ad to class variable and as well to react state.\n        if (!this.component_data) return;\n        const data = this.component_data;\n        this.component_start_time = parseInt(data[this.current_component_index]['start']);\n        this.image_url = data[this.current_component_index]['img_url'];\n        this.redirect_url = data[this.current_component_index]['ad_url'];\n        this.product_details = data[this.current_component_index]['product_details'];\n        this.component_end_time = parseInt(data[this.current_component_index]['end']);\n\n    }\n\n\n}\n","\nexport const queryData = (file_name: string):Promise<[]> => {\n\n    return new Promise((res, rej) => {\n        if (!file_name.includes('.json')) {\n            file_name += '.json';\n        }\n        fetch(`https://storage.googleapis.com/maxtap-adserver-dev.appspot.com/${file_name}`\n            , {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Accept: \"application/json\",\n                },\n            }\n        )\n            .then(fetch_res => {\n                fetch_res.json().then((json_data: []) => {\n                    json_data.sort((a, b) => {\n                        if (parseInt(a['start']) < parseInt(b['start'])) {\n                            return -1;\n                        }\n                        if (parseInt(a['start']) > parseInt(b['start'])) {\n                            return 1;\n                        }\n                        return 0;\n                    })\n                    res(json_data);\n                })\n            }).catch(err => {\n                rej(err);\n            })\n    })\n}","export const MaxTapComponentElementId = 'maxtap-component';\nexport const GoogleAnalyticsCode  ='G-05P2385Q2K';\nexport const MaxTapMainContainerId = 'maxtap-container';\nexport const DataAttribute = 'data-maxtap_ad'\n"],"names":["content_id","file_name","_this","video","document","querySelector","Promise","res","rej","includes","fetch","method","headers","Accept","then","fetch_res","json","json_data","sort","a","b","parseInt","err","data","component_data","setRequiredComponentData","initializeComponent","maxtap_component","getElementById","addEventListener","interval_id","setInterval","image_loaded","component_start_time","currentTime","console","log","prefetchImage","canComponentDisplay","displayComponent","canCloseComponent","current_component_index","removeCurrentComponent","error","style","width","height","parentElement","ad_ele","createElement","main_container","className","id","display","onComponentClick","appendChild","Image","src","is_component_showing","component_end_time","innerHTML","product_details","image_url","window","gtag","Math","floor","redirect_url","open","css_file","href","rel","ga_script","async","dataLayer","push","arguments","Date","head_tag","this","length","clearInterval"],"mappings":"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"}